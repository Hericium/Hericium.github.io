---
title: vue微信分享
date: 2019-01-21 19:28:04
tags: 编程
---
> 今天碰到了微信分享的需求，总体上来讲还是比较简单的，但是还是碰到了一个假想的坑(真的是假想),😇 
[api地址]( https://mp.weixin.qq.com/wiki?t=resource/res_main&id=mp1421141115)
### 1. 思路
  - 步骤一：绑定域名
  - 引入JS文件
  - 通过config接口注入权限验证配置(反正微信的东西都有这一步)😛
  - 通过ready接口处理成功验证
  - 通过error接口处理失败验证
<!-- more -->
### 2. 实现

  1.绑定域名，在公众号后台绑定域名，所以最后的测试一定要是线上环境(要么用内网穿透，这样容易调试,不用每一次都发测试环境)

  2.在index.html文件里面引入 
    http://res.wx.qq.com/open/js/jweixin-1.4.0.js  // 注意协议

  3.通过config接口注入权限验证配置, 下面五个参数都是通过请求后台，后台返回给你的。 注意: 当前页面的url是要在这个接口里给后台的，后台才能生成可用的签名算法, url的格式如下: url（当前网页的URL，不包含#及其后面部分),所以要注意vue-router的模式(jsApiList是调用的事件，api文档附录2里面有)

```
    wx.config({
      debug: false, // 是否开启调试模式
      appId: appId, //appid
      timestamp: timestamp, // 时间戳 
      nonceStr: nonceStr, // 随机字符串，只有这个是驼峰🎃 
      signature: signature, // 签名
      jsApiList: [
        "onMenuShareTimeline",
        "onMenuShareAppMessage",
        "onMenuShareQQ",
        "onMenuShareWeibo",
        "onMenuShareQZone"
      ] // 需要使用的JS接口列表
    });

    // 判断当前客户端版本是否支持指定JS接口 ,这步可无
    wx.checkJsApi({
      jsApiList: [
        "onMenuShareTimeline",
        "onMenuShareAppMessage",
        "onMenuShareQQ",
        "onMenuShareWeibo",
        "onMenuShareQZone"
      ], // 需要检测的JS接口列表，所有JS接口列表见附录2,
      success: function(res) {
        console.log(res);
        // 以键值对的形式返回，可用的api值true，不可用为false
        // 如：{"checkResult":{"chooseImage":true},"errMsg":"checkJsApi:ok"}
      }
    });
```

![微信分享](https://pxw-my.oss-cn-hangzhou.aliyuncs.com/blog/20190121202108.png)

```
    // 通过ready接口处理成功验证
    wx.ready(function() {
      const share = {
        title: mainTitle,   // 分享出去的title
        desc: subTitle,     // 描述信息
        imgUrl: smallIcons, // 分享的小图标
        link: url,          // 分享的除去的url
        success: function() {
          dosometing();     // 分享成功，成功之后要做的事情
        },
        cancel: function() {
          dosometing();     // 分享取消，取消之后要做的事情
        }
      };
      wx.onMenuShareAppMessage(share); // 微信好友
      wx.onMenuShareTimeline(share); // 朋友圈
      wx.onMenuShareQQ(share); // QQ
      wx.onMenuShareQZone(share); // QQ空间
      wx.onMenuShareWeibo(share); // 腾讯微博
    });

    // 如果失败 , 获取失败信息 
    wx.error(function(res) {
      console.log("错误", res);
    });

```

### 3.假想的坑

![分享蒙层](https://pxw-my.oss-cn-hangzhou.aliyuncs.com/blog/20190121200918.png)

 我看别人的分享，点击分享都是有如上一个引导图的(以为是官网自带的)，但是我做好没有引导图，我开始一直以为哪一步出问题了，后来发现，这个图是要自己加的，点击分享，打开这个蒙层，在成功回调里面，把这个蒙层去掉。😅

